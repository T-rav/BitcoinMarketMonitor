<!doctype html>
<html lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="A front-end template that helps you build fast, modern mobile web apps.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bitcoin Charts Markets</title>

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" sizes="192x192" href="images/touch/chrome-touch-icon-192x192.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Web Starter Kit">
    <link rel="apple-touch-icon-precomposed" href="apple-touch-icon-precomposed.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#3372DF">

    <!-- SEO: If your mobile URL is different from the desktop URL, add a canonical link to the desktop page https://developers.google.com/webmasters/smartphone-sites/feature-phones -->
    <!--
    <link rel="canonical" href="http://www.example.com/">
    -->

    <!-- Page styles -->
    <!--<link rel="stylesheet" href="styles/main.css">-->
	<link href="styles/bootstrap.min.css" rel="stylesheet">
	
  </head>
  <body>
  
    <header class="app-bar promote-layer">
      <div class="app-bar-container">
        <span style="margin-left:-2px;">
			<h2 class="logo">Bitcoin<strong>Markets</strong></h2>
		</span>
		<span style="float:right;">
			<button class="menu"><img src="images/hamburger.svg" alt="Menu"></button>
		</span>
        <section class="app-bar-actions">
        </section>
      </div>
    </header>
	<nav class="navdrawer-container promote-layer navbar navbar-inverse">
	  <h4 class="logo"><b>Currencies</b></h4>
	  <ul class="nav navbar-nav" data-bind="foreach:fiatCurrency">
		<li class="listMenuItem"><a href='#' data-bind="click: $parent.setData"><span data-bind="text: name"></span></a></li>
	  </ul>
	</nav>

	<main class="main-container">
		<div style="margin-left:5px;"><b>Currency</b> : <span data-bind="text: currency"></span></div>
		<table class="table table-striped" style="font-size:12px;">
			<thead>
				<tr class="tableRow">
					<td class="tableHeader"> Symbol </td>
					<td class="tableHeader"> Latest&nbsp;Price </td>
					<td class="tableHeader"> Average </td>
					<td class="tableHeader"> Volume </td>
					<td class="tableHeader tableRowFixCell"> </td>
				</tr>
			</thead>
			<tbody data-bind="foreach:exchangeState">
				<tr>
					<td class="tableCell" data-bind="text: symbol"> </td>
					<td class="tableCell" data-bind="text: ask"> </td>
					<td class="tableCell" data-bind="text: avg"> </td>
					<td class="tableCell" data-bind="text: volume"> </td>
					<td class="tableCell tableRowFixCell"> </td>
				</tr>
			</tbody>	
		</table>
		<div class="lastSync"> Last Sync : <span data-bind="text: lastSync"></span></div>
	</main>
	<div  id="error" class="alert alert-dismissable alert-danger footer">
	  <button type="button" class="close" data-dismiss="alert">×</button>
	  <strong>Oh snap!</strong> <span>An error occurred fetching data. Please ensure your wifi or mobile data is on.</span>
	</div>
	
    <!-- build:js scripts/main.min.js -->
	<script src="scripts/001_WebHelper.js"></script>
	<script src="scripts/002_PrefsHelper.js"></script>
	<script src="scripts/998_app.js"></script>
	<script src="scripts/999_main.js"></script>
	<script src="libs/jquery.js"></script>
	<script src="libs/knockout.js"></script>
	<script src="libs/bootstrap.min.js"></script>
    <script src="libs/docs.min.js"></script>
	
	<script type="text/javascript">

		function ViewModel(){
			var self = this;
			
			self.message = ko.observable("");
			self.lastSync = ko.observable("In Progress...");
			self.data = []; // Raw data
			self.currency = ko.observable(""); // Initially blank				
			self.fiatCurrency = ko.observableArray([]);
			self.exchangeState = ko.observableArray([]);
			
			self.addCurrency = function(currency){
				self.fiatCurrency.push({name : currency});
			};
					
			self.setExchangeData = function(key){
				self.exchangeState(self.data[key]);
			};
			
			self.setData = function(data, event){
				// set currency
				var fiat = data["name"];
				self.currency(fiat);
				self.setExchangeData(fiat);
			};
			
			self.showError = function(){
				$("#error").show();
			};
			
			self.setLastSync = function(){
				var currentdate = new Date(); 
				var hours = currentdate.getHours();
				var mins = currentdate.getMinutes();
				var secs = currentdate.getSeconds();
				
				if(hours < 10){
					hours = "0" + hours;
				}
				
				if(mins < 10){
					mins = "0" + mins;
				}
				
				if(secs < 10){
					secs = "0" + secs;
				}	
				
				var datetime = hours + ":" + mins + ":" + secs;
								
				viewModel.lastSync(datetime);
			
			};

		};
		
		function fetchData(init){
			viewModel.lastSync("In Progress...");
			$.ajax({
					url : "http://kungfuactiongrip.com/bitcoincharts/?jsoncallback=?",
					dataType : 'jsonp',
					crossDomain : true,
					async: true,
					success : function(data){
						viewModel.data = data;
						// Default to USD
						if(init){
							$.each(data, function(k,v){
								viewModel.addCurrency(k);
							});
						
							viewModel.setExchangeData("USD");
							ko.applyBindings(viewModel);
						}else{
							viewModel.setExchangeData(self.currency());
						}
						
						// set the sync time ;)
						viewModel.setLastSync();
					},
					error : function(){
						viewModel.showError();
					}
				});	
		}
		
		var viewModel = new ViewModel();
		$(function() {
		
				viewModel.currency("USD"); // Text appears
				$("#error").hide();
				fetchData(true);
		});

	</script>
    <!-- endbuild -->
  </body>
</html>
